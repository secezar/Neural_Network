from random import random, uniform

import numpy as np
from  matrix import mean


def initialize_weights(weights_range=(-1, 1), input_shape=(0,0)):
    return [[uniform(*weights_range) for _ in range(input_shape[1])] for _ in range(input_shape[0])]


def initialize_bias(input_shape=0):
    return [[random() for _ in range(input_shape)]]


def get_batches(batch_size, train_data):
    return [train_data[i:i + batch_size] for i in range(0, len(train_data), batch_size)]


def get_split(data, start, stop):
    return data[start:stop]


def to_categorical(y, num_classes=None):
    if not num_classes:
        num_classes = np.max(y) + 1
    n = y.shape[0]
    categorical = np.zeros((n, num_classes))
    categorical[np.arange(n), y] = 1
    return categorical


def to_label(y):
    for i in range(len(y)):
        if y[i] == 1:
            return i

def vectorize_data(matrix):
    return np.reshape(matrix, (matrix.shape[0], 1, matrix.shape[1] * matrix.shape[2]))


def batch_errors_mean(batch):
    layers = [[] for _ in batch[0]]
    for sample in range(len(batch)):
        for i in range(len(batch[sample])):
            layers[i].append(batch[sample][i][0])
    return [[(mean(elem)) for elem in zip(*layer)] for layer in layers]


flatten = lambda l: [item for sublist in l for item in sublist]


# batch = [[[[-0.5046578603192384, -0.829657673772497, -0.8622103249699938, -0.27188304179777745, -0.5998403970238876, -0.617961374316918, 0.28050166484937933, -0.7258016113353386, -0.8235058149343422, -0.4718935901151791]],
#           [[-0.01796952562568936, -0.36129009532487993, -0.3008484009231822, 0.1335000071582931, 0.17924596744323767, -0.027100551382749256, 0.07855477625271635, -0.04089608396427038, -0.0025569165032804857, -0.21592644543091236, 0.29829419589139683, 0.14325459900643048, 0.15844769722480884, -0.09198161404297875, -0.08411816216074569, -0.1605635227823418, 0.2970394002462918, 0.15261838934702004, 0.033599635306502854, -0.05988218412414848, 0.10732180811730097, 0.09034613472871439, 0.07663804291004979, -0.3936588834070556, -0.008209231632357511, -0.03830975239059495, 0.18200994706303275, -0.00945806483986336, 0.2005733656753063, -0.24893117817038798]],
#           [[0.21457217226276654, 0.03020505859172219, -0.013223628447157455, -0.06625216605363649, 0.17439166636436082, -0.04829502950319882, 0.015968753251962595, -0.12179122560745562, -0.08844960049534925, -0.09788162525189817, -0.0430832274827142, -0.09640923876887837, -0.09524813095515917, -0.05150126712371633, -0.03534529869296345, -0.0771679257966071, 0.07074940284468112, 0.11581749554041769, 0.03274737019917742, -0.036683551850165357, -0.11807929078422248, 0.026900622563431415, 0.06597586771332868, 0.06893966032770518, 0.02987064556579486, 0.13040696492068307, 0.029959596777922863, -0.09202389297483947, 0.1509558707491781, 0.04179545555852324, 0.1877489267352338, 0.022189113320838387, -0.05352711428611181, -0.21986603108727718, -0.09373109815373021, 0.04009774082691694, -0.14868232860838493, -0.01783231183488393, 0.1657436008042485, -0.11023376732004579, 0.052823775942530064, 0.037516054228419665, 0.11163247682787499, 0.047568671142140535, -0.06018136253515719, 0.06115402197071103, 0.021444165025581788, 0.00596097348917352, -0.19389942017907352, 0.07241474605524591, 0.04901214513467119, -0.0005486733988122857, 0.11177460976004845, 0.0714607773077165, 0.1595515216849169, -0.033057959854869375, 0.05321166805944821, -0.018920048532090953, 0.08167881001328578, 0.08658748272185003, -0.15847760199973404, -0.07311287377684135, 0.019965470018879404, -0.0932740127885916, -0.13204505598081914, 0.07601045835975985, -0.018548999371492965, -0.027195381315790614, 0.03653085276360765, -0.05262041551608106]]],
#          [[[-0.5459036451795223, -0.8589830953010632, -0.9418227878534366, -0.16865938086383978, 0.44012725328838986, -0.6642261212531919, -0.6435963093056011, -0.787106361237178, -0.7836377309352308, -0.1819245091153575]],
#           [[-0.2949246237876944, -0.261058048068854, -0.1788952504361486, -0.08102157526870386, 0.26825498931640956, 0.28367080955823276, 0.0586189855518039, 0.11291116452957406, 0.1410510432493606, -0.3071398784287278, 0.19501957639350362, 0.039736515389060006, -0.07898779269480057, -0.28724594546817184, -0.19384674665212331, -0.14023710911899348, 0.36657583980771646, -0.2189840844071778, 0.03487596230901227, 0.04225939069197984, 0.20288569183750527, 0.18874818153278017, 0.12903157182128097, -0.43394277736760783, 0.01456312920377552, -0.19430751671510296, 0.19995459872522175, 0.08461384342051487, 0.2822200315155426, -0.19875253948466873]],
#           [[0.23516435340783065, -0.12477699740381913, 0.01617971821986191, -0.006651794391134016, 0.006012467894761852, 0.014723529861231337, 0.04700538543607107, 0.0029814779149958505, -0.13054619778032814, 0.02529666433563325, -0.1467716220809216, -0.06487248706808878, -0.0868833472389637, -0.028761589297897603, 0.018142346150482325, -0.07953421458768868, -0.04561451061722573, 0.09746059039927715, 0.055168793307549334, -0.018602961631735384, 0.08865159892004466, -0.03414140651027771, 0.13611842385027886, 0.06075382317905186, -0.002559552169278437, 0.18452667101191014, -0.08061935472057624, -0.04186256437598889, 0.16387007968325534, 0.08090185147185776, 0.12293516356229409, -0.10218031494651302, -0.052607568953070484, -0.11946618383046054, -0.23998655488772022, 0.0671383494693178, -0.29302232505867465, -0.042288012727816675, 0.12768102511764295, -0.09684626097132813, -0.08994479304469093, 0.10935459723881204, 0.08041244685752073, 0.031000673019093806, 0.014231156756736361, -0.017656909387028293, 0.22914617615200977, 0.0546577787174409, -0.04868329355515137, -0.08654891128149401, -0.018226819413521382, 0.09140876874112913, 0.18615493887101506, 0.07901380000145847, 0.1445263777639647, 0.1454745652455165, 0.09359924949170124, -0.05983168677882114, 0.05080258923590861, -0.0020871064008302093, -0.10674977577417133, -0.04841419979005585, -0.03433356833680616, -0.01737476039623322, 0.009978105490990104, 0.08791327232671163, -0.0010357550405463095, -0.09608160794012166, -0.0988776130822678, -0.01976508091749359]]],
#          [[[-0.6268077810297088, -0.8686421687373361, -0.8340251810753223, -0.260789955831733, -0.5190325768372647, -0.6784636635084853, -0.7344643052789683, -0.6818283349577874, 0.10352605189401609, -0.3983765640209711]],
#           [[-0.2740518261504368, -0.1817133426462402, -0.08206770090794914, -0.2678389216233351, -0.0047150701126938265, 0.16901113083002123, 0.044641284330216593, 0.06228337994755782, 0.10246241969954502, -0.3246297928059001, -0.0891147937667914, 0.07530957054513862, -0.0048266724702571515, -0.2528326756363885, -0.21286237977336372, -0.23790862184452946, 0.32537025544518633, -0.04954140492038861, 0.12171976342132912, 0.00184751036472514, 0.18356731938416163, 0.2710898084856579, -0.08833646935740855, -0.2122812346527051, -0.07554650109959427, -0.1023526844682999, 0.07746353181806472, 0.1056304648210533, 0.33835558228501605, -0.11007004319714887]],
#           [[0.07421514489095375, -0.07892240460896603, 0.05825836212041884, 0.06406605548677671, -0.0015130453150517572, -0.0949672097125486, 0.0013101096539686222, -0.0778926783212496, 0.03856333691053165, -0.10197036000657192, -0.03012084474944495, -0.07901914872237227, -0.05233950078633503, 0.032002169217347935, 0.022678021923816943, -0.04559495828577326, 0.049126747312850653, 0.0547743967564049, -0.09930788745295317, -0.004964113760296851, 0.0627493078091161, -0.0014497863183696863, 0.02305584798873619, 0.010199370756664477, 0.10778341397044583, 0.05135714418181159, 0.031996200859835414, -0.07979068303905033, 0.05627171357788423, 0.020799958906446762, -0.047379754750134694, -0.01050579352922167, -0.007517331423878591, -0.027757733966945305, -0.025970428316352264, 0.06716247024029033, -0.08722431956233441, 0.02676784127777469, 0.015689873924708286, -0.02552582373385326, -0.12907535942596018, 0.15227534128163406, 0.04558808961484765, 0.03594270162170969, -0.04184954607890064, 0.029061112881981273, 0.03815287351420079, -0.016406579642224136, -0.0015468471619124258, -0.02900938280725941, -0.03812873518448721, 0.0639227894361868, 0.0597379772642749, 0.01993793491016683, 0.08383158700934942, 0.059053033180340594, 0.045685361458600256, -0.0009417610070256788, 0.1105360943151135, -0.0064077525218176855, -0.06095078868807083, 0.012316793027898506, 0.03947112625339186, -0.031670696805009314, -0.00857464968883033, -0.024411207535591815, 0.038465264869039464, -0.06836401818228464, -0.007588180465820367, -0.0713900685988553]]],
#          [[[-0.5630679456921349, -0.8524378985958094, -0.9019910755231417, -0.22948479864534616, -0.6865847140047767, -0.6868016548359458, -0.6873455617241446, -0.7148934613500577, 0.15194841211896826, -0.32485353080745477]],
#           [[-0.1498778306696097, -0.04959060650378171, -0.16082765493978327, -0.2377056940685348, -0.08875110339409337, 0.13146987039565572, -0.06427861084235335, 0.17662489215090238, 0.14996684873300162, -0.3940512048600425, 0.03604016957737898, 0.05070054421684395, -0.06175106616191915, -0.12066052248980134, -0.32566931111426733, -0.2069920932844835, 0.3688066681807999, 0.08685575029243364, 0.22657414902912976, 0.12206594119218998, 0.13151334841823206, 0.2192297143426679, -0.11787013667953185, -0.29149681643367664, -0.16728032390777117, -0.20554948647581064, 0.07860143035727757, 0.005293319555800166, 0.17646910892531886, -0.20264491129753515]],
#           [[0.13947257472009056, -0.16947731025078497, 0.09959238165376719, 0.08288305027259275, -0.02630436600930845, -0.06247128063577309, -0.037003502691842174, -0.15700630861791617, -0.04924673158175554, -0.04289735681161443, -0.07594668624599757, 0.007430550354413994, -0.0888322628880048, -0.05972145405559013, -0.10267065355878413, -0.02372661420552602, 0.05896416500770876, 0.018446659798217517, -0.05578696806436536, -0.04997504716868853, -0.07136221374364957, 0.01926910449892596, -0.06413587250767154, 0.09694091983906605, 0.06187666979175614, 0.26267626157569457, 0.06229844384216401, -0.16490258436857666, 0.13552830844253858, 0.028516741938560963, 0.026658466627557813, -0.018643643955050696, -0.016825108869243065, -0.05974402786248777, -0.18556307230791813, -0.029859724238406, -0.008009722783934825, -0.10754054116152888, 0.08595779920456995, -0.08983157668808447, -0.01628945563499865, 0.0504406809548937, 0.15476195070493554, 0.08137151610400511, 0.011637572603635382, 0.06395578082487684, 0.1580903905123608, 0.041374091613958525, -0.17724479276199806, -0.00437310402763242, -0.060457558117546495, 0.15389244005973313, 0.02184345982546119, 0.04488544561854332, 0.1520018536230596, 0.04839233439196612, 0.15825449583944265, -0.006869227085691318, 0.11710805602596377, 0.07769167053245465, -0.14002996849132493, -0.15611227399285244, -0.03551183461542562, -0.1193729087335848, 0.1168143452044927, 0.062104546734430714, 0.07609144716538882, 0.07238830468447498, 0.06510599814624786, 0.0058818421868085825]]]]
#
# a = batch_errors_mean(batch)
